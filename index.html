<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Door Supervisor Training</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .sticky-links {
            position: sticky;
            top: 20px;
        }
        .checkbox-custom {
            accent-color: #3b82f6;
        }
        .radio-custom {
            accent-color: #3b82f6;
        }
        .popup-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        .date-option:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .file-upload-area.dragover {
            border-color: #10b981;
            background-color: #d1fae5;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @media (max-width: 768px) {
            .sticky-links {
                position: static;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Right Column Booking Box -->
            <div class="lg:w-1/3">
                <div class="sticky-links">
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-5">
                            <div class="flex justify-between items-center">
                                <h4 class="text-xl font-bold">Book Now</h4>
                                <div class="bg-white text-blue-700 rounded-full w-10 h-10 flex items-center justify-center">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                            </div>
                            <p class="text-blue-100 mt-2 text-sm">Select your course and dates</p>
                        </div>
                        
                        <div class="p-5">
                            <!-- OPTION 1 - With First Aid Certificate -->
                            <div class="border border-gray-200 rounded-lg p-5 mb-6 hover:shadow-md transition-shadow duration-300">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">With First Aid Certificate</h3>
                                        <p class="text-gray-600 text-sm">Upload your valid certificate first</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold text-green-600">£350</p>
                                        <p class="text-gray-500 text-sm line-through">£400</p>
                                        <p class="text-green-500 text-sm font-semibold">Save £50</p>
                                    </div>
                                </div>
                                
                                <button onclick="openPdfUploadPopup()" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                                    <i class="fas fa-upload mr-2"></i> Upload Certificate - £350
                                </button>
                            </div>
                            
                            <!-- OPTION 2 - Complete Package -->
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-md transition-shadow duration-300">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">Complete Package</h3>
                                        <p class="text-gray-600 text-sm">Includes First Aid training</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold text-blue-600">£400</p>
                                        <p class="text-gray-500 text-sm">Everything included</p>
                                    </div>
                                </div>
                                
                                <button onclick="openDatePopup('complete-package', 400)" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                                    <i class="fas fa-calendar-check mr-2"></i> Select Dates - £400
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- PDF Upload Popup (for £350 option) -->
    <div id="pdfUploadPopup" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 transition-opacity popup-overlay" aria-hidden="true"></div>
            
            <!-- Popup Content -->
            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full slide-in">
                <div class="bg-white px-6 pt-6 pb-4">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">Upload First Aid Certificate</h2>
                            <p class="text-gray-600">Required for £350 booking option</p>
                        </div>
                        <button onclick="closePopup('pdfUploadPopup')" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="border-t border-b border-gray-200 py-4 my-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-semibold text-gray-800">Door Supervisor - Level 2</h3>
                            <span class="text-lg font-bold text-green-600">£350</span>
                        </div>
                        <p class="text-gray-600 text-sm">6-day intensive training program</p>
                    </div>
                    
                    <!-- Upload Instructions -->
                    <div class="mb-6">
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-info-circle text-blue-400"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-blue-700">
                                        Please upload a valid PDF copy of your First Aid Certificate. 
                                        The PDF will be sent to our team for verification.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Email Notification -->
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-envelope text-yellow-400"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">
                                        <strong>Note:</strong> Your certificate will be automatically sent to 
                                        <span class="font-semibold">tfgdeveloper2@gmail.com</span> for verification.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- File Upload Area -->
                        <div class="file-upload-area p-6 text-center cursor-pointer" id="fileUploadArea">
                            <input type="file" id="pdfUpload" accept=".pdf" class="hidden">
                            <div class="mb-4">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-file-pdf text-blue-500 text-2xl"></i>
                                </div>
                                <h4 class="font-semibold text-gray-900 mb-1">Upload PDF Certificate</h4>
                                <p class="text-gray-600 text-sm mb-2">Click to browse or drag and drop</p>
                                <p class="text-gray-500 text-xs">Maximum file size: 5MB</p>
                            </div>
                            <button onclick="document.getElementById('pdfUpload').click()" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors duration-300">
                                <i class="fas fa-folder-open mr-2"></i> Choose File
                            </button>
                        </div>
                        
                        <!-- Selected File Preview -->
                        <div id="selectedFilePreview" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-file-pdf text-green-500 text-xl"></i>
                                </div>
                                <div class="ml-3 flex-1">
                                    <p class="font-medium text-green-800" id="fileName"></p>
                                    <p class="text-green-600 text-sm" id="fileSize"></p>
                                </div>
                                <button onclick="removeFile()" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="hidden mt-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium text-blue-700">Uploading...</span>
                                <span class="text-sm font-medium text-blue-700" id="uploadPercent">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <!-- Email Sending Progress -->
                        <div id="emailProgress" class="hidden mt-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-envelope text-blue-500 mr-2"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium text-blue-700">Sending to tfgdeveloper2@gmail.com...</span>
                                        <span class="text-sm font-medium text-blue-700" id="emailPercent">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div id="emailProgressBar" class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Success Message -->
                        <div id="emailSuccess" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-green-800">Certificate sent successfully!</p>
                                    <p class="text-sm text-green-600">Your PDF has been sent to tfgdeveloper2@gmail.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Terms Checkbox -->
                    <div class="mb-6">
                        <div class="flex items-start">
                            <input type="checkbox" id="certificateTerms" class="checkbox-custom mt-1 mr-3 h-5 w-5">
                            <label for="certificateTerms" class="text-gray-700 text-sm">
                                I confirm that I have a valid First Aid Certificate and this uploaded document is authentic.
                            </label>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-3">
                        <button onclick="sendEmailAndProceed()" id="verifyButton" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-paper-plane mr-2"></i> Send & Continue
                        </button>
                        <button onclick="closePopup('pdfUploadPopup')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg transition-colors duration-300">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Date Selection Popup -->
    <div id="datePopup" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Overlay -->
            <div class="fixed inset-0 transition-opacity popup-overlay" aria-hidden="true"></div>
            
            <!-- Popup Content -->
            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full slide-in">
                <div class="bg-white px-6 pt-6 pb-4">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900" id="popupTitle"></h2>
                            <p class="text-gray-600" id="popupSubtitle"></p>
                        </div>
                        <button onclick="closePopup('datePopup')" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <!-- First Aid Dates (for Complete Package only) -->
                    <div id="firstAidSection" class="hidden mb-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">First Aid Course Dates</h3>
                        <div class="space-y-3">
                            <div class="date-option p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-start">
                                    <input type="radio" name="firstAidDate" id="faid1" value="5th January" class="radio-custom mt-1 mr-3 h-5 w-5">
                                    <label for="faid1" class="cursor-pointer flex-1">
                                        <span class="font-medium text-gray-900 block">5th January</span>
                                        <span class="text-gray-600 text-sm">1-day course</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="date-option p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-start">
                                    <input type="radio" name="firstAidDate" id="faid2" value="12th January" class="radio-custom mt-1 mr-3 h-5 w-5">
                                    <label for="faid2" class="cursor-pointer flex-1">
                                        <span class="font-medium text-gray-900 block">12th January</span>
                                        <span class="text-gray-600 text-sm">1-day course</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="date-option p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-start">
                                    <input type="radio" name="firstAidDate" id="faid3" value="19th January" class="radio-custom mt-1 mr-3 h-5 w-5">
                                    <label for="faid3" class="cursor-pointer flex-1">
                                        <span class="font-medium text-gray-900 block">19th January</span>
                                        <span class="text-gray-600 text-sm">1-day course</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Door Supervisor Dates -->
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 mb-4" id="dsTitle"></h3>
                        <div class="space-y-3">
                            <!-- Option 1 -->
                            <div class="date-option p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-start">
                                    <input type="radio" name="dsDate" id="ds1" value="6th-11th January" class="radio-custom mt-1 mr-3 h-5 w-5">
                                    <label for="ds1" class="cursor-pointer flex-1">
                                        <span class="font-medium text-gray-900 block">6th - 11th January</span>
                                        <span class="text-gray-600 text-sm">6-day course</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Option 2 -->
                            <div class="date-option p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-start">
                                    <input type="radio" name="dsDate" id="ds2" value="13th-18th January" class="radio-custom mt-1 mr-3 h-5 w-5">
                                    <label for="ds2" class="cursor-pointer flex-1">
                                        <span class="font-medium text-gray-900 block">13th - 18th January</span>
                                        <span class="text-gray-600 text-sm">6-day course</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Option 3 -->
                            <div class="date-option p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-start">
                                    <input type="radio" name="dsDate" id="ds3" value="20th-25th January" class="radio-custom mt-1 mr-3 h-5 w-5">
                                    <label for="ds3" class="cursor-pointer flex-1">
                                        <span class="font-medium text-gray-900 block">20th - 25th January</span>
                                        <span class="text-gray-600 text-sm">6-day course</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Selected Dates Summary -->
                    <div id="selectedDates" class="hidden mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">Selected Dates:</h4>
                        <div id="selectedDatesContent" class="space-y-2"></div>
                    </div>
                    
                    <!-- Quantity -->
                    <div class="mt-6">
                        <label class="block text-gray-700 font-medium mb-2">Number of Participants</label>
                        <div class="flex items-center">
                            <button onclick="updateQuantity(-1)" class="w-10 h-10 rounded-l-lg border border-gray-300 bg-gray-100 flex items-center justify-center hover:bg-gray-200">
                                <i class="fas fa-minus text-gray-600"></i>
                            </button>
                            <input type="number" id="quantity" value="1" min="1" class="w-16 h-10 text-center border-t border-b border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button onclick="updateQuantity(1)" class="w-10 h-10 rounded-r-lg border border-gray-300 bg-gray-100 flex items-center justify-center hover:bg-gray-200">
                                <i class="fas fa-plus text-gray-600"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Total Price -->
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-bold text-gray-900">Total Amount:</span>
                            <span id="totalPrice" class="text-2xl font-bold text-green-600">£350.00</span>
                        </div>
                    </div>
                    
                    <!-- Add to Cart Button -->
                    <div class="mt-6">
                        <button onclick="redirectToCart()" id="addToCartBtn" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-all duration-300 shadow-lg hover:shadow-xl">
                            <i class="fas fa-shopping-cart mr-2"></i> Add to Cart - £<span id="cartPrice">350.00</span>
                        </button>
                        <p class="text-center text-gray-500 text-sm mt-3">
                            You will be redirected to our secure cart to complete your purchase
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPackage = '';
        let currentPrice = 0;
        let selectedFirstAidDate = '';
        let selectedDSDate = '';
        let quantity = 1;
        let uploadedFile = null;
        
        // Your email address
        const recipientEmail = 'tfgdeveloper2@gmail.com';
        
        // Your Add to Cart URLs (REPLACE THESE WITH YOUR ACTUAL LINKS)
        const addToCartURLs = {
            'door-supervisor-only': 'https://yourwebsite.com/cart/?add-to-cart=123&quantity=',
            'complete-package': 'https://yourwebsite.com/cart/?add-to-cart=456&quantity='
        };
        
        // Open PDF upload popup for £350 option
        function openPdfUploadPopup() {
            // Reset file state
            uploadedFile = null;
            document.getElementById('certificateTerms').checked = false;
            document.getElementById('verifyButton').disabled = true;
            document.getElementById('selectedFilePreview').classList.add('hidden');
            document.getElementById('emailProgress').classList.add('hidden');
            document.getElementById('emailSuccess').classList.add('hidden');
            
            // Show popup
            document.getElementById('pdfUploadPopup').classList.remove('hidden');
            document.body.style.overflow = "hidden";
            
            // Initialize file upload listeners
            initializeFileUpload();
        }
        
        // Open date selection popup
        function openDatePopup(packageType, price) {
            currentPackage = packageType;
            currentPrice = price;
            
            // Update popup title
            document.getElementById('popupTitle').textContent = 
                packageType === 'door-supervisor-only' 
                ? 'Select Door Supervisor Dates' 
                : 'Select Course Dates';
                
            document.getElementById('popupSubtitle').textContent = 
                packageType === 'door-supervisor-only' 
                ? 'Door Supervisor Only - £350' 
                : 'Complete Package - £400';
            
            // Show/hide first aid section
            if (packageType === 'complete-package') {
                document.getElementById('firstAidSection').classList.remove('hidden');
                document.getElementById('dsTitle').textContent = 'Door Supervisor Course Dates';
            } else {
                document.getElementById('firstAidSection').classList.add('hidden');
                document.getElementById('dsTitle').textContent = 'Select Course Dates';
            }
            
            // Reset selections
            resetSelections();
            updateTotalPrice();
            
            // Show popup
            document.getElementById('datePopup').classList.remove('hidden');
            document.body.style.overflow = "hidden";
        }
        
        // Close popup
        function closePopup(popupId) {
            document.getElementById(popupId).classList.add('hidden');
            document.body.style.overflow = "auto";
        }
        
        // Initialize file upload functionality
        function initializeFileUpload() {
            const fileUpload = document.getElementById('pdfUpload');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const verifyButton = document.getElementById('verifyButton');
            const termsCheckbox = document.getElementById('certificateTerms');
            
            // Click on area to trigger file input
            fileUploadArea.addEventListener('click', () => fileUpload.click());
            
            // Drag and drop functionality
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type === 'application/pdf') {
                        handleFileSelection(file);
                    } else {
                        alert('Please upload a PDF file only.');
                    }
                }
            });
            
            // File input change
            fileUpload.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    const file = e.target.files[0];
                    if (file.type === 'application/pdf') {
                        handleFileSelection(file);
                    } else {
                        alert('Please upload a PDF file only.');
                        fileUpload.value = '';
                    }
                }
            });
            
            // Terms checkbox change
            termsCheckbox.addEventListener('change', () => {
                verifyButton.disabled = !(uploadedFile && termsCheckbox.checked);
            });
        }
        
        // Handle file selection
        function handleFileSelection(file) {
            // Check file size (max 5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB in bytes
            if (file.size > maxSize) {
                alert('File size exceeds 5MB limit. Please choose a smaller file.');
                return;
            }
            
            uploadedFile = file;
            
            // Update UI
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('selectedFilePreview').classList.remove('hidden');
            
            // Enable verify button if terms are checked
            const verifyButton = document.getElementById('verifyButton');
            const termsChecked = document.getElementById('certificateTerms').checked;
            verifyButton.disabled = !termsChecked;
            
            // Simulate upload progress
            simulateUploadProgress();
        }
        
        // Remove selected file
        function removeFile() {
            uploadedFile = null;
            document.getElementById('pdfUpload').value = '';
            document.getElementById('selectedFilePreview').classList.add('hidden');
            document.getElementById('verifyButton').disabled = true;
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('emailProgress').classList.add('hidden');
            document.getElementById('emailSuccess').classList.add('hidden');
        }
        
        // Simulate upload progress
        function simulateUploadProgress() {
            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const uploadPercent = document.getElementById('uploadPercent');
            
            uploadProgress.classList.remove('hidden');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                uploadPercent.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        uploadProgress.classList.add('hidden');
                    }, 500);
                }
            }, 100);
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        // Send email and proceed to date selection
        async function sendEmailAndProceed() {
            if (!uploadedFile) {
                alert('Please upload your First Aid Certificate PDF.');
                return;
            }
            
            if (!document.getElementById('certificateTerms').checked) {
                alert('Please confirm that your certificate is valid and authentic.');
                return;
            }
            
            // Show email sending progress
            document.getElementById('emailProgress').classList.remove('hidden');
            const emailProgressBar = document.getElementById('emailProgressBar');
            const emailPercent = document.getElementById('emailPercent');
            
            // Simulate email sending progress
            let progress = 0;
            const emailInterval = setInterval(() => {
                progress += 10;
                emailProgressBar.style.width = `${progress}%`;
                emailPercent.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(emailInterval);
                    
                    // Show success message
                    setTimeout(() => {
                        document.getElementById('emailProgress').classList.add('hidden');
                        document.getElementById('emailSuccess').classList.remove('hidden');
                        
                        // In a real application, you would send the email here
                        // For now, we'll simulate it
                        simulateEmailSending();
                        
                        // Proceed to date selection after a delay
                        setTimeout(() => {
                            closePopup('pdfUploadPopup');
                            openDatePopup('door-supervisor-only', 350);
                        }, 1500);
                    }, 500);
                }
            }, 100);
        }
        
        // Simulate email sending (in production, use a backend service)
        async function simulateEmailSending() {
            // In a real application, you would:
            // 1. Send the file to your backend
            // 2. Use a service like EmailJS, SendGrid, or your own SMTP server
            // 3. Send the PDF as an attachment to tfgdeveloper2@gmail.com
            
            // Example using FormData (requires backend endpoint)
            /*
            const formData = new FormData();
            formData.append('pdfFile', uploadedFile);
            formData.append('recipientEmail', recipientEmail);
            formData.append('subject', 'First Aid Certificate Upload - Door Supervisor Booking');
            formData.append('message', 'A customer has uploaded their First Aid Certificate for verification.');
            
            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error('Failed to send email');
                }
                
                const result = await response.json();
                console.log('Email sent successfully:', result);
            } catch (error) {
                console.error('Error sending email:', error);
                alert('There was an error sending the email. Please try again.');
            }
            */
            
            console.log('Simulating email to:', recipientEmail);
            console.log('File:', uploadedFile.name);
            console.log('File size:', uploadedFile.size);
            
            // For now, just log the details
            alert(`In production, the PDF would be sent to ${recipientEmail}`);
        }
        
        // Reset all selections
        function resetSelections() {
            selectedFirstAidDate = '';
            selectedDSDate = '';
            quantity = 1;
            
            // Uncheck all radio buttons
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            
            // Reset quantity
            document.getElementById('quantity').value = 1;
            
            // Hide selected dates
            document.getElementById('selectedDates').classList.add('hidden');
        }
        
        // Update quantity
        function updateQuantity(change) {
            const quantityInput = document.getElementById('quantity');
            let newQuantity = parseInt(quantityInput.value) + change;
            
            if (newQuantity < 1) newQuantity = 1;
            
            quantityInput.value = newQuantity;
            quantity = newQuantity;
            updateTotalPrice();
        }
        
        // Update total price
        function updateTotalPrice() {
            const total = currentPrice * quantity;
            document.getElementById('totalPrice').textContent = `£${total.toFixed(2)}`;
            document.getElementById('cartPrice').textContent = total.toFixed(2);
        }
        
        // Redirect to Add to Cart page
        function redirectToCart() {
            // Validate selections
            if (!selectedDSDate) {
                alert('Please select Door Supervisor course dates.');
                return;
            }
            
            if (currentPackage === 'complete-package' && !selectedFirstAidDate) {
                alert('Please select a First Aid course date.');
                return;
            }
            
            // Get the Add to Cart URL for selected package
            let cartUrl = addToCartURLs[currentPackage];
            
            if (!cartUrl) {
                alert('Error: Cart URL not found.');
                return;
            }
            
            // Add quantity to URL
            cartUrl += quantity;
            
            // Add date parameters if your system supports them
            // cartUrl += `&ds_date=${encodeURIComponent(selectedDSDate)}`;
            // if (selectedFirstAidDate) {
            //     cartUrl += `&fa_date=${encodeURIComponent(selectedFirstAidDate)}`;
            // }
            
            // Add file reference if uploaded (you would need server-side handling for this)
            // if (uploadedFile && currentPackage === 'door-supervisor-only') {
            //     cartUrl += `&certificate_uploaded=true`;
            // }
            
            // Redirect to your Add to Cart page
            window.location.href = cartUrl;
        }
        
        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // First Aid date selection
            document.querySelectorAll('input[name="firstAidDate"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        selectedFirstAidDate = this.value;
                        updateSelectedDates();
                    }
                });
            });
            
            // Door Supervisor date selection
            document.querySelectorAll('input[name="dsDate"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        selectedDSDate = this.value;
                        updateSelectedDates();
                    }
                });
            });
            
            // Quantity input change
            document.getElementById('quantity').addEventListener('change', function() {
                let value = parseInt(this.value);
                if (value < 1) this.value = 1;
                quantity = value;
                updateTotalPrice();
            });
            
            // Close popup when clicking outside
            window.onclick = function(event) {
                if (event.target.classList.contains('popup-overlay')) {
                    closePopup('pdfUploadPopup');
                    closePopup('datePopup');
                }
            }
        });
        
        // Update selected dates display
        function updateSelectedDates() {
            const selectedDatesDiv = document.getElementById('selectedDates');
            const contentDiv = document.getElementById('selectedDatesContent');
            
            let content = '';
            
            if (selectedDSDate) {
                content += `<p class="text-blue-700"><span class="font-medium">Door Supervisor:</span> ${selectedDSDate}</p>`;
            }
            
            if (selectedFirstAidDate) {
                content += `<p class="text-blue-700"><span class="font-medium">First Aid Course:</span> ${selectedFirstAidDate}</p>`;
            }
            
            if (content) {
                contentDiv.innerHTML = content;
                selectedDatesDiv.classList.remove('hidden');
            } else {
                selectedDatesDiv.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
